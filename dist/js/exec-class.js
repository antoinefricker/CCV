var KPF;KPF||(KPF={}),KPF.global||(KPF.global={}),KPF.global.PRODUCTION=!0,KPF.global.FORMAT_INDENT="   ";var KPF;KPF||(KPF={}),KPF.utils||(KPF.utils={},KPF.utils._logBuildStr=function(i,t){var e;return KPF.utils.isdefined(t)&&(e="["+t+"] "),KPF.utils.isdefined(i)&&(e=e?e+i:i),e},KPF.utils.error=function(i,t,e){var s=KPF.utils._logBuildStr(i,t);s?e?console.error(s,e):console.error(s):e&&console.error(e)},KPF.utils.warn=function(i,t,e){var s=KPF.utils._logBuildStr(i,t);s?e?console.warn(s,e):console.warn(s):e&&console.warn(e)},KPF.utils.log=function(i,t,e){if(KPF.global.PRODUCTION){var s=KPF.utils._logBuildStr(i,t);s?e?console.log(s,e):console.log(s):e&&console.log(e)}},KPF.utils.degToRad=function(i){return i/180*Math.PI},KPF.utils.rad2Deg=function(i){return i/Math.PI*180},KPF.utils.digits2=function(i){return i<10?"0"+i:i},KPF.utils.randomInt=function(i,t){return i=Math.ceil(i),t=Math.floor(t),Math.floor(Math.random()*(t-i+1))+i},KPF.utils.clamp=function(i,t,e){return Math.max(t,Math.min(e,i))},KPF.utils.fillTo=function(i,t,e){for(i=i.toString();i.length<t;)i=e+i;return i},KPF.utils.isfilled=function(i){return"string"==typeof i&&i.length>0},KPF.utils.keepNumeric=function(i){return i.match(/\d/g).join("")},KPF.utils.repeat=function(i,t){var e="";if(isNaN(i))i=0;else if(!KPF.utils.isdefined(t))return KPF.utils.warn("Illegal arguments","KPF.utils.repeat",{iteration:i,pattern:t}),e;for(;i>0;)e+=t,--i;return e},KPF.utils.isdefined=function(i){return void 0!==i&&null!==i},KPF.utils.isstring=function(i){return"string"==typeof i},KPF.utils.isarray=function(i){return Array.isArray?Array.isArray(i):"[object Array]"===objectToString(i)},KPF.utils.isbool=function(i){return"boolean"==typeof i},KPF.utils.isan=function(i){return"number"==typeof i&&i+1==i+1},KPF.utils.arrGetUnique=function(i){for(var t={},e=[],s=0,o=i.length;s<o;++s)t.hasOwnProperty(i[s])||(e.push(i[s]),t[i[s]]=1);return e});var CCV,proto;proto=PIXI.Point.prototype,proto.scale=function(i){this.x*=i,this.y*=i},proto.floor=function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},proto.ceil=function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y)},proto.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y)},proto.minus=function(i){this.x-=i.x,this.y-=i.y},proto.plus=function(i){this.x+=i.x,this.y+=i.y},proto.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},proto.to=function(i){i.x=this.x,i.y=this.y},proto.toString=function(){return"[PIXI.Point] x: "+this.x.toFixed(1)+", y: "+this.y.toFixed(1)},CCV||(CCV={}),CCV.global||(CCV.global={RED:16727593,BLUE:11391722,MAGNIFIER_RED:16717077,MAGNIFIER_APPEAR_TIME:.7,MAGNIFIER_VANISH_TIME:.3,DEBUG_LANDSCAPE_GFX:!1,DEBUG_SCENE_GFX:!1,DEBUG_SCENE_MARGINS:!1,DEBUG_PERFORMANCE:!0,FPS:8,GLOBAL_VOLUME:0,RANDOM_INDEX:!0,AUTO_RENDER:!1,ACTIVITY_RANGE:0,SOURCE_ALLOW_LARGE:!1,SLIDE_DURATION:1.6,HEADER_HEIGHT:0,FOOTER_HEIGHT:0,MAGNIFIER_PINCH_AMP:200,MAGNIFIER_PINCH_INCREMENT:.7,LANDSCAPE_HEIGHT:1336,GROUND_HEIGHT:200,MAGNIFIER_DRAG_IDLE_TEMPO:12e3,SWIPE_THRESHOLD:250,SWIPE_VIVACITY:400,SWIPE_VELOCITY:300}),CCV.app||(CCV.app={}),CCV.app.Player||(CCV.app.Player=function(i,t){this.target=i,this.options=Object.assign({forceCanvas:!1,useSharedTicker:!0,mediaFolder:"theme/mm/",magnifierDisplayStatus:!0,scenesShowFillStatus:!0,magnifierRadius:250,configurationFile:"json/configComplete.json"},t),CCV.player=this,this.application=new PIXI.Application(800,600,{backgroundColor:16777215,view:this.target,transparent:!1,antialias:!0,preserveDrawingBuffer:!1,resolution:1,legacy:!1},this.options.forceCanvas,this.options.useSharedTicker),CCV.global.AUTO_RENDER||this.application.stop(),this.animTicker=new CCV.app.AnimationsTicker,this.callbacks={},this.callbacks.windowFocus=this.windowFocus.bind(this),this.callbacks.windowBlur=this.windowBlur.bind(this),this.callbacks.resize=this.resize.bind(this),this.callbacks.swipeContext={name:"swipeContext",active:!1,startTime:Number.NaN,startX:Number.NaN},this.callbacks.swipeStart=this._swipeStart.bind(this,this.callbacks.swipeContext),this.callbacks.swipeEnd=this._swipeEnd.bind(this,this.callbacks.swipeContext),this.callbacks.magnifierContext={name:"magnifierContext",dragTouch:null,pinchTouch:null},this.callbacks.magnifierDragStart=this._magnifierDragStart.bind(this,this.callbacks.magnifierContext,this.callbacks.swipeContext),this.callbacks.magnifierDragMove=this._magnifierDragMove.bind(this,this.callbacks.magnifierContext,this.callbacks.swipeContext),this.callbacks.magnifierDragEnd=this._magnifierDragEnd.bind(this,this.callbacks.magnifierContext,this.callbacks.swipeContext),window.onfocus=this.callbacks.windowFocus,window.onblur=this.callbacks.windowBlur,window.onresize=this.callbacks.resize,this.landscapeHeight=CCV.global.LANDSCAPE_HEIGHT,this.groundHeight=CCV.global.GROUND_HEIGHT,this.resizeInit(),this.configurationLoad()},proto=CCV.app.Player.prototype,proto.getMode=function(){return this.application.renderer instanceof PIXI.WebGLRenderer?"WebGL":"canvas"},proto.configurationLoad=function(){var i=this;$.ajax({url:this.options.configurationFile,dataType:"json",method:"GET",data:{context:KPF.global.PRODUCTION},error:function(t,e){KPF.utils.error('Unable to load configuration, url: "'+i.options.configurationFile+'", textStatus: "'+e+'"',"Application.loadConfiguration")},success:function(t,e){KPF.utils.log('Configuration loaded, textStatus: "'+e+'"',"Application.loadConfiguration"),i.configurationParse(t)}})},proto.configurationParse=function(i){this.landscape=new CCV.app.Landscape(i.landscape),this.application.stage.addChild(this.landscape.view),this.background=new PIXI.Graphics,this.background.beginFill(65280,0),this.background.drawRect(0,0,100,100),this.application.stage.addChild(this.background),this.magnifier=new CCV.app.Magnifier(this.options.magnifierRadius),this.application.stage.addChild(this.magnifier.view),this.resize(),CCV.global.RANDOM_INDEX&&this.landscape.pickRandomScene(!1),this.initInteractions(),this.magnifierDisplayToggle(this.options.magnifierDisplayStatus),this.scenesShowFillToggle(this.options.scenesShowFillStatus!==!1),this.windowFocus(),this.landscape.audio.play()},proto.initInteractions=function(){this.background.interactive=!0,this.background.on("pointerdown",this.callbacks.swipeStart).on("pointerupoutside",this.callbacks.swipeEnd).on("pointerup",this.callbacks.swipeEnd),this.magnifier.view.interactive=!0,this.magnifier.view.on("pointerdown",this.callbacks.magnifierDragStart).on("pointerup",this.callbacks.magnifierDragEnd).on("pointerupoutside",this.callbacks.magnifierDragEnd).on("pointermove",this.callbacks.magnifierDragMove)},proto._magnifierDragStart=function(i,t,e){window.clearTimeout(i.idleTimeoutId),i.dragTouch?i.pinchTouch||(i.pinchTouch=this._createTouch(e),i.pinchStartScale=this.magnifier.pinchScale,i.pinchStartDelta=this._pinchComputeDelta(i)):i.dragTouch=this._createTouch(e)},proto._magnifierDragMove=function(i,t,e){var s,o;if(o=e.data.getLocalPosition(this.application.stage),i.pinchTouch){switch(e.data.identifier){case i.dragTouch.id:i.dragTouch.copy(o);break;case i.pinchTouch.id:i.pinchTouch.copy(o)}s=this._pinchComputeDelta(i)-i.pinchStartDelta,s=KPF.utils.clamp(s,-CCV.global.MAGNIFIER_PINCH_AMP,CCV.global.MAGNIFIER_PINCH_AMP)/CCV.global.MAGNIFIER_PINCH_AMP,this.magnifier.pinchScale=i.pinchStartScale+s*CCV.global.MAGNIFIER_PINCH_INCREMENT}else i.dragTouch&&e.data.identifier==i.dragTouch.id&&(this.magnifier.pos=o)},proto._magnifierDragEnd=function(i,t,e){i.dragTouch=null,i.pinchTouch=null,i.idleTimeoutId=window.setTimeout(this._magnifierTidy,CCV.global.MAGNIFIER_DRAG_IDLE_TEMPO)},proto._magnifierTidy=function(i){var t,e;t=CCV.player,e={x:.5*t.size.x,y:t.size.y},i===!1?t.magnifier.pos=e:TweenMax.to(t.magnifier,.4,{ease:Circ.easeInOut,pinchScale:1,x:e.x,y:e.y})},proto._pinchComputeDelta=function(i){var t=new PIXI.Point;return t.copy(i.pinchTouch),t.minus(i.dragTouch),t.getLength()},proto._createTouch=function(i){return Object.assign(i.data.getLocalPosition(CCV.player.application.stage),{id:i.data.identifier})},proto._swipeStart=function(i,t){i.active||(i.active=!0,i.startTime=(new Date).getTime(),i.startX=t.data.getLocalPosition(this.application.stage).x)},proto._swipeEnd=function(i,t){var e,s,o,n,a,r,h;s=t.data.getLocalPosition(this.application.stage).x-i.startX,o=Math.abs(s)>CCV.global.SWIPE_THRESHOLD,n=(new Date).getTime()-i.startTime,a=n<CCV.global.SWIPE_VIVACITY,r=Math.abs(s)/n*1e3,h=r>=CCV.global.SWIPE_VELOCITY,e="threshold: "+s.toFixed(1)+" (pass: "+o+"),",e+=" vivacity: "+n.toFixed(2)+" (pass: "+a+"),",e+=" velocity: "+r.toFixed(2)+" (pass: "+h+")",KPF.utils.log(e,"Player._swipeEnd"),i.active=!1,i.startTime=Number.NaN,i.startX=Number.NaN,o&&a&&h&&this.landscape.move(-s)},proto.magnifierDisplayToggle=function(i){this.magnifierDisplayStatus=KPF.utils.isbool(i)?i:!this.magnifierDisplayStatus,KPF.utils.log("magnifierDisplayStatus: "+this.magnifierDisplayStatus,"CCV.app.Player"),this.magnifierDisplayStatus?(this._magnifierTidy(!1),TweenMax.to(this.magnifier,CCV.global.MAGNIFIER_APPEAR_TIME,{scale:1,ease:Expo.easeIn,overwrite:"all"})):TweenMax.to(this.magnifier,CCV.global.MAGNIFIER_VANISH_TIME,{scale:0,ease:CustomEase.create("custom","M0,0,C0.646,-0.888,0.536,0.894,1,1"),overwrite:"all"}),$(this.target).trigger("magnifierDisplayChange",[this.magnifierDisplayStatus])},proto.scenesShowFillToggle=function(i){i=KPF.utils.isbool(i)?i:!this.scenesShowFillStatus,this.scenesShowFillStatus=i,KPF.utils.log("scenesShowFillStatus: "+this.scenesShowFillStatus,"Player.scenesShowFillToggle"),this.landscape.scenes.forEach(function(t){t.showFill(i)}),$(this.target).trigger("scenesShowFillChange",[this.scenesShowFillStatus])},proto.windowBlur=function(){KPF.utils.log("Stop application rendering","Player.windowBlur"),this.animTicker.stop(),this.application.stop(),PIXI.ticker.shared.stop()},proto.windowFocus=function(){KPF.utils.log("Start application rendering","Player.windowFocus"),PIXI.ticker.shared.start(),this.animTicker.start()},proto.resizeInit=function(){var i=screen.height-CCV.global.FOOTER_HEIGHT-CCV.global.HEADER_HEIGHT;CCV.global.SOURCE_ALLOW_LARGE&&i>.5*(CCV.global.LANDSCAPE_HEIGHT+CCV.global.GROUND_HEIGHT)?(this.scaleFolder="x2",this.scaleSourceCoef=1):(this.scaleFolder="x1",this.scaleSourceCoef=.5),CCV.global.LANDSCAPE_HEIGHT*=this.scaleSourceCoef,this.landscapeHeight*=this.scaleSourceCoef,this.groundHeight*=this.scaleSourceCoef,this.options.mediaFolder+=this.scaleFolder+"/",KPF.utils.log("scale folder: "+this.scaleFolder+", scaleSourceCoef: "+this.scaleSourceCoef.toFixed(1),"Player.resizeInit")},proto.resize=function(){var i=!1;this.size=new PIXI.Point(window.innerWidth,window.innerHeight),this.size.y-=CCV.global.HEADER_HEIGHT,this.size.y-=CCV.global.FOOTER_HEIGHT,this.background.width=this.size.x,this.background.height=this.size.y,this.application.renderer.resize(this.size.x,this.size.y),this.scale=this.size.y/(this.landscapeHeight+this.groundHeight),this.scale>1&&(i=!0,this.scale=1),KPF.utils.log("application size: "+this.size.toString(),"Player.resize"),KPF.utils.log("application scale: "+this.scale.toFixed(2)+" (scaleOverflow: "+i+")","Player.resize"),this.magnifier.redraw(this.scale),this._magnifierTidy(!1),this.landscape.resize(this.size,this.scale)},proto.triggerIndex=function(i,t,e){$(this.target).trigger("sceneIndexChange",[i,t,e])}),CCV.app.Landscape||(CCV.app.Landscape=function(i){this.view=void 0,this.ground=void 0,this.scenesScroll=void 0,this.scenesCtn=void 0,this.debugGfx=void 0,this.scenes=[],this.index=0,this.size=new PIXI.Point,this.xCenter=0,this.parse(i)},proto=CCV.app.Landscape.prototype,proto.resize=function(i,t){var e,s;this.scenesCtn.scale=new PIXI.Point(t,t),this.size=i.clone(),this.size.scale(1/t),this.size.round(),s=CCV.player.landscapeHeight+CCV.player.groundHeight,this.size.y>s&&(this.size.y=s,this.view.y=Math.round(.66*(i.y-this.size.y))),console.log("scale: "+t,"deltaScene: "+(this.size.y-i.y)),this.xCenter=Math.round(.5*this.size.x),this.debugGfx.clear(),CCV.global.DEBUG_LANDSCAPE_GFX&&(e=.5*this.size.y,this.debugGfx.lineStyle(4,26163,1),this.debugGfx.moveTo(this.xCenter-20,e),this.debugGfx.lineTo(this.xCenter+20,e),this.debugGfx.moveTo(this.xCenter,e-20),this.debugGfx.lineTo(this.xCenter,e+20),this.debugGfx.lineStyle(),this.debugGfx.beginFill(16711680,.2),this.debugGfx.drawRect(0,0,this.size.x,CCV.player.landscapeHeight),this.debugGfx.endFill(),this.debugGfx.lineStyle(),this.debugGfx.beginFill(0,.2),this.debugGfx.drawRect(0,CCV.player.landscapeHeight,this.size.x,CCV.player.groundHeight),this.debugGfx.endFill()),this.setIndex(this.index,!1)},proto.toString=function(){this.info(0)},proto.info=function(i,t){var e,s="",o=this.scenes.length,n=KPF.global.FORMAT_INDENT;isNaN(i)&&(i=0),e=KPF.utils.repeat(i,n),t===!0&&(s=e),s+="[Landscape] ("+o+" scenes)";for(var a=0;a<o;++a)s+="\n"+e+n+this.scenes[a].info(i+1,!1);return s},proto.parse=function(i){var t,e,s,o=CCV.player.landscapeHeight;for(i.audio&&(this.audio=new CCV.app.AudioChannel(i.audio,null,!0)),this.scenes=[],t=0,e=i.scenes?i.scenes.length:0;t<e;++t)this.scenes.push(new CCV.app.Scene(i.scenes[t]));for(this.view=new PIXI.Container,this.scenesCtn=new PIXI.Container,this.view.addChild(this.scenesCtn),this.scenesScroll=new PIXI.Container,this.scenesCtn.addChild(this.scenesScroll),t=0,e=this.scenes.length,s=0;t<e;++t)scene=this.scenes[t],scene.view.y=o-scene.size.y,this.scenesScroll.addChild(scene.view),s+=scene.marginLeft+scene.marginRight+scene.size.x;this.ground=new CCV.app.Ground(i.ground),this.ground.view.position=new PIXI.Point(0,o+this.ground.pos.y),this.scenesCtn.addChild(this.ground.view),this.debugGfx=new PIXI.Graphics,this.scenesCtn.addChild(this.debugGfx),this.scenes[0].view.x=this.scenes[0].marginLeft,this._reArrangeScenesFrom(0)},proto.pickRandomScene=function(i){var t,e;for(e=this.index;!KPF.utils.isan(t)||e==t;)t=KPF.utils.randomInt(0,this.scenes.length-1),this.scenes[t].indexable||(t=Number.NaN);i=i!==!1,KPF.utils.log("index: "+t+", doTransition: "+i,"CCV.app.Landscape.pickRandomScene"),this.setIndex(t,i)},proto.move=function(i){0!=i&&this.setIndex(this.index+(i>0?1:-1))},proto.setIndex=function(i,t){var e,s,o,n,a,r;if(t=t!==!1,0==(s=this.scenes.length))return void KPF.log("[CCV.app.Landscape.setSceneIndex] Illegal call; scenes is empty");for(i<0?i=s-1:i>s-1&&(i=0),this.index=parseInt(i),a=-Math.floor(s/2),r=Math.floor(s/2),e=0;e<s;++e)n=e-this.index,n<a?n+=s:n>r&&(n-=s),this.scenes[e].activateDisplay(n);this._reArrangeScenesFrom(this.index),scene=this.scenes[this.index],o=this.xCenter-scene.view.x-scene.xCenter,t?TweenMax.to(this.scenesScroll,CCV.global.SLIDE_DURATION,{x:o,ease:Expo.easeInOut}):this.scenesScroll.x=o,KPF.utils.log("index: "+this.index+" (scene #"+this.scenes[this.index].id+"), xTarget: "+o,"CCV.app.Landscape.setIndex"),CCV.player.triggerIndex(this.index,this.scenes[this.index],this.scenes.length)},proto._reArrangeScenesFrom=function(i){var t,e,s,o,n;for(s=this.scenes[i],o=s.view.x-s.marginLeft,t=1,e=this.scenes.length;t<=3;++t){for(n=i-t;n<0;)n+=e;n%=e,s=this.scenes[n],o-=s.size.x+s.marginRight,s.view.x=o,o-=s.marginLeft}for(s=this.scenes[i],o=s.view.x+s.size.x+s.marginRight,t=1,e=this.scenes.length;t<e-3;++t){for(n=i+t;n<0;)n+=e;n%=e,s=this.scenes[n],o+=s.marginLeft,s.view.x=o,o+=s.size.x+s.marginRight}}),CCV.app.Scene||(CCV.app.Scene=function(i){this.id=i.id,this.folder=CCV.player.options.mediaFolder+i.folder+"/",this.indexable=i.indexable!==!1,this.marginLeft=i.marginLeft*CCV.player.scaleSourceCoef,this.marginRight=i.marginRight*CCV.player.scaleSourceCoef,this.size=new PIXI.Point(i.size.x,i.size.y),this.size.scale(CCV.player.scaleSourceCoef),this.xCenter=Math.round(.5*this.size.x),this.red=new CCV.app.CompoLayer(i.red),i.audio&&(this.audio=new CCV.app.AudioChannel(i.audio,this)),i.red&&(this.redOutline=this.red.addLayer(i.red.outline,this),this.redFill=this.red.addLayer(i.red.fill,this)),this.blue=this.factoryModel(i.blue),this.viewBuild()},proto=CCV.app.Scene.prototype,proto.toString=function(){return this.info(0)},proto.info=function(i,t){var e,s="",o=KPF.global.FORMAT_INDENT;return isNaN(i)&&(i=0),e=KPF.utils.repeat(i,o),t===!0&&(s=e),s+="[Scene] #"+this.id,this.redFill&&(s+="\n"+e+o+"redFill: "+this.redFill.info(i+1,!1)),this.redOutline&&(s+="\n"+e+o+"redOutline: "+this.redOutline.info(i+1,!1)),this.blue&&(s+="\n"+e+o+"blue: "+this.blue.info(i+1,!1)),s},proto.factoryModel=function(i){return i?KPF.utils.isarray(i)?new CCV.app.CompoLayer(i,this):i.hasOwnProperty("video")?new CCV.app.VideoLayer(i,this):i.hasOwnProperty("seqEnd")?new CCV.app.LayerSequence(i,this):new CCV.app.Layer(i,this):null},proto.showFill=function(i){this.redFill&&TweenMax.to(this.redFill.view,.3,{ease:Expo.easeOut,alpha:i?1:0})},proto.viewBuild=function(){var i,t,e,s,o={fontFamily:"Verdana",fontSize:12,fill:0};this.view=new PIXI.Container,this.blue&&this.blue.view&&this.view.addChild(this.blue.view),this.redFill&&this.redFill.view&&(this.redFill.view.blendMode=PIXI.BLEND_MODES.MULTIPLY,this.view.addChild(this.redFill.view)),this.redOutline&&this.redOutline.view&&(this.redOutline.view.blendMode=PIXI.BLEND_MODES.MULTIPLY,this.view.addChild(this.redOutline.view)),CCV.global.DEBUG_SCENE_GFX&&(i=new PIXI.Container,t=new PIXI.Graphics,t.lineStyle(2,16711680,1),t.drawRect(0,0,this.size.x,this.size.y),i.addChild(t),CCV.global.DEBUG_SCENE_MARGINS&&(t=new PIXI.Graphics,t.lineStyle(2,65280,1),t.drawRect(-this.marginLeft,0,this.marginLeft,this.size.y),i.addChild(t),t=new PIXI.Graphics,t.lineStyle(2,255,1),t.drawRect(this.size.x,0,this.marginRight,this.size.y),i.addChild(t)),e=new PIXI.Text("#"+this.id,o),e.position=new PIXI.Point(10,10),i.addChild(e),s=function(i,t,e){var s=new PIXI.Graphics;return s.lineStyle(e,t,1),s.drawCircle(i.x,i.y,10),s.moveTo(i.x,i.y),s.lineTo(i.x+20,i.y),s.moveTo(i.x,i.y),s.lineTo(i.x,i.y+20),s},this.red&&i.addChild(s(this.red.pos||new PIXI.Point(0,0),16711680,3)),this.blue&&i.addChild(s(this.blue.pos||new PIXI.Point(0,0),255,1)),i.cacheAsBitmap=!0,this.view.addChild(i))},proto.activateDisplay=function(i){var t,e,s;s=Math.abs(i)<=CCV.global.ACTIVITY_RANGE,this.audio&&(t=s?1:Math.max(0,1-.6*Math.abs(i)),e=KPF.utils.clamp(.6*i,-1,1),this.audio.isPlaying()||(startAtValues={volume:0}),TweenMax.to(this.audio,CCV.global.SLIDE_DURATION,{volume:t,pan:e,delay:.3,onUpdate:this.audio.render.bind(this.audio)}),t>0&&!this.audio.isPlaying()&&(this.audio.play(),this.audio.render())),$(this).trigger("displayStateChange",[s])}),CCV.app.CompoLayer||(CCV.app.CompoLayer=function(i,t){if(this.pos=new PIXI.Point(0,0),this.layers=[],i){i.pos&&this.pos.copy(i.pos),this.pos.scale(CCV.player.scaleSourceCoef);for(var e=0,s=i.length;e<s;++e)this.addLayer(i[e],t)}},proto=CCV.app.CompoLayer.prototype,proto.addLayer=function(i,t){var e=t.factoryModel(i);return this.layers.push(e),e},proto.toString=function(){return this.info(0)},proto.info=function(i,t){var e,s,o=KPF.global.FORMAT_INDENT,n=this.layers.length;isNaN(i)&&(i=0),s=KPF.utils.repeat(i,o),e=t===!0?s:"",e+="[CompoLayer] "+n+" layers";for(var a=0;a<n;++a)e+="\n"+this.layers[a].info(i+1,!0);return e}),CCV.app.Layer||(CCV.app.Layer=function(i,t){this.file=t.folder+i.file,this.pos=new PIXI.Point,i.pos&&this.pos.copy(i.pos),this.pos.scale(CCV.player.scaleSourceCoef),this.view=PIXI.Sprite.fromImage(this.file)},proto=CCV.app.Layer.prototype,proto.toString=function(){return this.info(0)},proto.info=function(i,t){var e,s=KPF.global.FORMAT_INDENT;return e=t===!0?KPF.utils.repeat(i||0,s):"",e+='[Layer] file: "'+this.file+'"'}),CCV.app.LayerSequence||(CCV.app.LayerSequence=function(i,t){this.scene=t,this.parse(i),this.view=new PIXI.Container,i.hasOwnProperty("preview")&&(this.preview=new PIXI.Sprite(new PIXI.Texture.fromImage(this.scene.folder+i.preview)),this.view.addChild(this.preview)),this.active=void 0,$(this.scene).on("displayStateChange",this.activateDisplay.bind(this)),this.activateDisplay(null,!1)},proto=CCV.app.LayerSequence.prototype,proto.parse=function(i){this.pos=new PIXI.Point(0,0),i.pos&&this.pos.copy(i.pos),this.pos.scale(CCV.player.scaleSourceCoef),this.seqNumLength=i.seqNumLength||-1,this.seqStart=i.seqStart||1,this.seqEnd=i.seqEnd||1,this.file=i.file,this.loop=i.loop!==!1},proto.toString=function(){return this.info(0)},proto.info=function(i,t){var e;return e=t===!0?KPF.utils.repeat(i||0,KPF.global.FORMAT_INDENT):"",e+="[LayerSequence] "+(this.seqEnd-this.seqStart)+" frames ["+this.seqStart+" -> "+this.seqEnd+"]"},proto.activateDisplay=function(i,t){t=t!==!1,this.active!==t&&(this.active=t,this.preview,this.active||!this.preview?(this.animation||this._createAnimation(),CCV.player.animTicker.addAnimation(this.animation)):this.animation&&(CCV.player.animTicker.removeAnimation(this.animation),this.view.removeChild(this.animation),this.animation.destroy(!0),this.animation=null,this.view.removeChild(this.border),this.border.destroy(),this.border=null))},proto._createAnimation=function(){var i,t,e;for(this.textures=[],i=this.seqStart;i<this.seqEnd;++i)t=this.seqNumLength>0?KPF.utils.fillTo(i,this.seqNumLength,"0"):this.seqStart+i,e=this.scene.folder+this.file.replace("[NUM]",t),this.textures.push(new PIXI.Texture.fromImage(e));this.animation=new PIXI.extras.AnimatedSprite(this.textures,!1),this.animation.textures=this.textures,this.animation.gotoAndStop(1),this.view.addChild(this.animation),this.border=new PIXI.Graphics,this.border.lineStyle(4,16777215,1),this.border.drawRect(this.pos.x,this.pos.y,this.scene.size.x-this.pos.x,this.scene.size.y-this.pos.y),this.view.addChild(this.border)}),CCV.app.VideoLayer||(CCV.app.VideoLayer=function(i,t){this.scene=t,this.file=this.scene.folder+i.video,this.loop=i.loop!==!1,this.pos=new PIXI.Point(0,0),i.pos&&this.pos.copy(i.pos),this.pos.scale(CCV.player.scaleSourceCoef),this.pos.floor(),this.view=new PIXI.Container,this.preview=PIXI.Sprite.fromImage(this.scene.folder+i.preview),this.view.addChild(this.preview),this.active=void 0,$(this.scene).on("displayStateChange",this.activateDisplay.bind(this)),this.activateDisplay(null,!1)},proto=CCV.app.VideoLayer.prototype,proto.toString=function(){return this.info(0)},proto.info=function(i,t){var e,s=KPF.global.FORMAT_INDENT;return e=t===!0?KPF.utils.repeat(i||0,s):"",e+='[VideoLayer] file: "'+this.file+'"'},proto.pause=function(){this.videoSource.pause()},proto.resume=function(){this.videoSource.play()},proto.activateDisplay=function(i,t){t=t!==!1,this.active!==t&&(this.active=t,this.preview,this.active?this.video||this._createVideo():this.preview?this.video&&this._destroyVideo():this.video||this._createVideo())},proto._destroyVideo=function(){KPF.utils.log("","VideoLayer._destroyVideo"),this.texture&&this.video&&(this.view.removeChild(this.video),this.video.destroy(!0),this.video=null,this.texture=null,this.view.removeChild(this.border),this.border.destroy(),this.border=null,$(this.videoSource).each(function(){this.pause(),$(this).empty(),$(this).remove(),delete this}),this.videoSource=null)},proto._createVideo=function(){KPF.utils.log("file: "+this.file,"VideoLayer._createVideo"),this.texture=PIXI.Texture.fromVideoUrl(this.file),this.videoSource=this.texture.baseTexture.source,this.videoSource.loop=this.loop,this.video=new PIXI.Sprite(this.texture),this.video.width=this.scene.size.x,this.video.height=this.scene.size.y,this.view.addChild(this.video),this.border=new PIXI.Graphics,this.border.lineStyle(4,16777215,1),this.border.drawRect(this.pos.x,this.pos.y,this.scene.size.x-this.pos.x,this.scene.size.y-this.pos.y),this.view.addChild(this.border)}),CCV.app.Ground||(CCV.app.Ground=function(i){var t;this.file=CCV.player.options.mediaFolder+i.file,this.pos=new PIXI.Point(i.pos.x,i.pos.y),this.pos.scale(CCV.player.scaleSourceCoef),this.size=new PIXI.Point(i.size.x,i.size.y),this.size.scale(CCV.player.scaleSourceCoef),this.view=new PIXI.Container,t=PIXI.Sprite.fromImage(this.file),t.blendMode=PIXI.BLEND_MODES.MULTIPLY,this.view.addChild(t),t=PIXI.Sprite.fromImage(this.file),t.blendMode=PIXI.BLEND_MODES.MULTIPLY,t.position=new PIXI.Point(this.size.x,0),this.view.addChild(t)}),CCV.app.Magnifier||(CCV.app.Magnifier=function(i){this.radius=i,this.view=new PIXI.Container,this.gfx=new PIXI.Graphics,this.gfx.blendMode=PIXI.BLEND_MODES.MULTIPLY,this.gfx.scale=new PIXI.Point(1,1),this.view.addChild(this.gfx),this._scale=0,this._x=0,this._y=0,Object.defineProperty(this,"pinchScale",{get:function(){return this.gfx.scale?this.gfx.scale.x:1},set:function(i){i=KPF.utils.clamp(i,1-CCV.global.MAGNIFIER_PINCH_INCREMENT,1+CCV.global.MAGNIFIER_PINCH_INCREMENT),this.gfx.scale=new PIXI.Point(i,i)}}),Object.defineProperty(this,"scale",{get:function(){return this.view.scale.x},set:function(i){this._scale=i,this._render()}}),Object.defineProperty(this,"x",{get:function(){return this._x},set:function(i){this._x=i,this._render()}}),Object.defineProperty(this,"y",{get:function(){return this._y},set:function(i){this._y=i,this._render()}}),Object.defineProperty(this,"pos",{get:function(){return{x:this._x,y:this._y}},set:function(i){this._x=i.x,this._y=i.y,this._render()}}),this.scale=0},proto=CCV.app.Magnifier.prototype,proto.redraw=function(i){this.gfx.clear(),this.gfx.beginFill(CCV.global.MAGNIFIER_RED),this.gfx.drawCircle(0,0,this.radius*CCV.player.scaleSourceCoef*i),this.gfx.endFill()},proto._render=function(){new PIXI.Point(this._x,this._y).to(this.view),this.view.scale.copy({x:this._scale,y:this._scale})}),CCV.app.AnimationsTicker||(CCV.app.AnimationsTicker=function(){this.askRenderCallback=this.askRender.bind(this),this.askRenderTimeoutId=null,this.scheduled=!1,this.deltaTime=Date.now(),this.time=0,this.animations=[],this.start()},proto=CCV.app.AnimationsTicker.prototype,proto.start=function(){this.askRender()},proto.stop=function(){clearTimeout(this.askRenderTimeoutId)},proto.addAnimation=function(i){this.animations.indexOf(i)<0&&this.animations.push(i)},proto.removeAnimation=function(i){var t=this.animations.indexOf(i);t>=0&&this.animations.splice(t,1)},proto.askRender=function(){if(this.scheduled=!1,this.deltaTime=Date.now()-this.time,this.deltaTime<1e3/CCV.global.FPS)return void(this.scheduled||(this.scheduled=!0,this.askRenderTimeoutId=setTimeout(this.askRenderCallback,1e3/CCV.global.FPS-this.deltaTime)));this.time+=this.deltaTime,CCV.global.AUTO_RENDER;for(var i,t,e,s=0,o=this.animations.length;s<o;++s)i=this.animations[s],t=i.totalFrames,e=i.currentFrame,i.gotoAndStop(1==t?0:e<t?e+1:0);requestAnimationFrame(this.askRenderCallback)}),CCV.app.AudioChannel||(CCV.app.AudioChannel=function(i,t,e){this.file=(t?t.folder:CCV.player.options.mediaFolder)+i.file,this.isLoop=i.isLoop!==!1,this.isStereo=i.isStereo!==!1,this.volumeCoef=KPF.utils.isan(i.volume)?i.volume:1,this.autoRender=e===!0,this.sound=new Howl({src:this.file,volume:0}),this._volume=1,this._pan=0,Object.defineProperty(this,"pan",{get:function(){return this._pan},set:function(i){this._pan=KPF.utils.clamp(i,-1,1),this.autoRender&&this.render()}}),Object.defineProperty(this,"volume",{get:function(){return this._volume},set:function(i){this._volume=i,this.autoRender&&this.render()}})},proto=CCV.app.AudioChannel.prototype,proto.isPlaying=function(){return this.soundId&&this.sound.playing(this.soundId)},proto.play=function(){this.soundId=this.sound.play(),this.sound.loop(this.isLoop,this.soundId),this.render()},proto.stop=function(){this.soundId&&(this.sound.stop(this.soundId),this.soundId=null)},proto.render=function(){this.soundId&&(this.sound.volume(CCV.global.GLOBAL_VOLUME*this.volumeCoef*this._volume,this.soundId),this.sound.stereo(this._pan,this.soundId))},proto.toString=function(){return"[AudioChannel] loop:"+this.loop+", stereo: "+this.stereo+", volumeCoef: "+this.volumeCoef},proto.info=function(i,t){var e,s=KPF.global.FORMAT_INDENT,o=KPF.utils.repeat(i||0,s);return e=t===!0?o:"",e+="[AudioChannel] ",e+="\n"+o+s+'file: "'+this.file+'"',e+="\n"+o+s+"loop:"+this.loop+", stereo: "+this.stereo+", volumeCoef: "+this.volumeCoef});