var DGN,proto;DGN||(DGN={core:{}},DGN.core.Application||(DGN.core.Application=function(e){this.cnv=document.getElementById("pixi-stage"),this.helpTl=null,this.page=null,$(".page").hide(),this.lang="fr"},proto=DGN.core.Application.prototype,proto.initialize=function(){var e,i,t;$("[data-lang]").on("click",function(){DGN.app.langSet($(this).data("lang"))}),$("#home").on("click","button.action-info",function(){DGN.app.pageSet("info")}).on("click","button.action-play",function(){DGN.app.pageSet("play")}),$("#help").on("click","button.action-close",function(){DGN.app.pageSet("play")}),e=$("#info"),e.on("click","button.action-home",function(){DGN.app.pageSet("home")}),t=e.find(".pagination"),e.find(".inner-page").each(function(e,i){$("<div />").on("click",function(){DGN.app.pageSet("info",{innerIndex:e})}).appendTo(t),$(i).swipe({swipe:function(e,i){console.log("direction: "+i),"right"!=i&&"left"!=i||DGN.app.pageSet("info",{move:i})},threshold:0})}),i=$("#play .footer-menu"),i.on("click",".red-home",function(){DGN.app.pageSet("home")}).on("click",".red-magnifier",function(){CCV.player.magnifierDisplayToggle()}).on("click",".red-help",function(){DGN.app.pageSet("help")}).on("click",".red-arrow",function(){i.toggleClass("opened")})},proto.langSet=function(e){e?"fr"!=e&&"en"!=e&&(e="en"):e=this.langGetFull(),this.lang=e,KPF.utils.log("Set application language: "+this.lang,"Application.langSet");var i="fr"==this.lang;$(".lang-fr").toggle(i),$(".lang-en").toggle(!i)},proto.langGetFull=function(){var e;return e=window.navigator.languages?window.navigator.languages[0]:null,e=e||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,this.langCleanResults(e)},proto.langGetNative=function(){return this.langCleanResults(window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage)},proto.langCleanResults=function(e){return e.indexOf("-")!==-1&&(e=e.split("-")[0]),e.indexOf("_")!==-1&&(e=e.split("_")[0]),e},proto.pageSet=function(e,i){e||(e="home"),"info"==e&&this._infoUtils(i),"help"==e?setTimeout(this._helpUtils.bind(this,!0),500):"help"==this.formerId&&this._helpUtils(!1),"play"==e?(CCV.player||new CCV.app.Player(this.cnv,{magnifierDisplayStatus:!1,scenesShowFillStatus:!0}),CCV.player.activate(!0)):"play"==this.formerId&&CCV.player.activate(!1),e!=this.formerId&&($("#"+e).show(),$("#"+this.formerId).hide()),KPF.utils.log("set page #"+e+(this.formerId?", remove page #"+this.formerId:""),"Application.setPage",i),this.formerId=e},proto._infoUtils=function(e){var i;e?e.innerIndex?this.infoIndex=e.innerIndex:"right"==e.move?this.infoIndex=this.infoIndex-1:"left"==e.move?this.infoIndex=this.infoIndex+1:this.infoIndex=0:this.infoIndex=0,this.infoIndex=KPF.utils.clamp(this.infoIndex,0,2)||0,KPF.utils.log("infoIndex: "+this.infoIndex,"Application._infoUtils"),i=$("#info"),i.find(".pagination").children().each(function(e,i){$(i).toggleClass("current",e==DGN.app.infoIndex)}),i.find(".inner-page").each(function(e,i){$(i).toggle(e==DGN.app.infoIndex)})},proto._helpUtils=function(e){if(console.log("_helpUtils (status: "+e+")"),e){var i,t,s,n,o,a,r,l;this.helpTl=new TimelineMax({repeat:-1,repeatDelay:1.5}),i=$("#help-animation1"),t=i.find(".hand"),s=i.find(".background"),n=i.width(),o=t.width(),a=s.width(),r=.5*n-.2*a-.77*o,l=r-.1*a,TweenMax.set(t,{x:l}),this.helpTl.add(new TweenMax(t,1.5,{ease:Power1.easeInOut,x:r})),this.helpTl.add(new TweenMax(t,1.5,{ease:Power1.easeInOut,x:l}),"+=.5"),i=$("#help-animation2"),t=i.find(".hand"),s=i.find(".background"),n=i.width(),o=t.width(),a=s.width(),r=.5*n- -.14*a-.05*o,startXPrime=r-.01*o,l=r+.1*a,TweenMax.set(t,{x:l}),this.helpTl.add(TweenMax.to(t,2,{ease:Power1.easeInOut,x:r}),"+=2"),this.helpTl.add(TweenMax.to(t,.2,{ease:Power1.easeInOut,y:10,x:startXPrime})),this.helpTl.add(TweenMax.to(t,.2,{ease:Power1.easeInOut,y:0,x:r}),"+=.2"),this.helpTl.add(TweenMax.to(t,2,{ease:Power1.easeInOut,x:l}),"+=.5"),this.helpTl.restart()}else this.helpTl&&(console.log(this.helpTl),this.helpTl.stop(),this.helpTl=null)}));var KPF;KPF||(KPF={}),KPF.global||(KPF.global={}),KPF.global.PRODUCTION=!0,KPF.global.FORMAT_INDENT="   ";var KPF;KPF||(KPF={}),KPF.utils||(KPF.utils={},KPF.utils._logBuildStr=function(e,i){var t;return KPF.utils.isdefined(i)&&(t="["+i+"] "),KPF.utils.isdefined(e)&&(t=t?t+e:e),t},KPF.utils.error=function(e,i,t){var s=KPF.utils._logBuildStr(e,i);s?t?console.error(s,t):console.error(s):t&&console.error(t)},KPF.utils.warn=function(e,i,t){var s=KPF.utils._logBuildStr(e,i);s?t?console.warn(s,t):console.warn(s):t&&console.warn(t)},KPF.utils.log=function(e,i,t){if(KPF.global.PRODUCTION){var s=KPF.utils._logBuildStr(e,i);s?t?console.log(s,t):console.log(s):t&&console.log(t)}},KPF.utils.degToRad=function(e){return e/180*Math.PI},KPF.utils.rad2Deg=function(e){return e/Math.PI*180},KPF.utils.digits2=function(e){return e<10?"0"+e:e},KPF.utils.randomInt=function(e,i){return e=Math.ceil(e),i=Math.floor(i),Math.floor(Math.random()*(i-e+1))+e},KPF.utils.clamp=function(e,i,t){return Math.max(i,Math.min(t,e))},KPF.utils.roundTo=function(e,i){return Math.round(e/i)*i},KPF.utils.floorTo=function(e,i){return Math.floor(e/i)*i},KPF.utils.ceilTo=function(e,i){return Math.ceil(e/i)*i},KPF.utils.fillTo=function(e,i,t){for(e=e.toString();e.length<i;)e=t+e;return e},KPF.utils.isfilled=function(e){return"string"==typeof e&&e.length>0},KPF.utils.keepNumeric=function(e){return e.match(/\d/g).join("")},KPF.utils.repeat=function(e,i){var t="";if(isNaN(e))e=0;else if(!KPF.utils.isdefined(i))return KPF.utils.warn("Illegal arguments","KPF.utils.repeat",{iteration:e,pattern:i}),t;for(;e>0;)t+=i,--e;return t},KPF.utils.isdefined=function(e){return void 0!==e&&null!==e},KPF.utils.isstring=function(e){return"string"==typeof e},KPF.utils.isarray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===objectToString(e)},KPF.utils.isbool=function(e){return"boolean"==typeof e},KPF.utils.isan=function(e){return"number"==typeof e&&e+1==e+1},KPF.utils.arrGetUnique=function(e){for(var i={},t=[],s=0,n=e.length;s<n;++s)i.hasOwnProperty(e[s])||(t.push(e[s]),i[e[s]]=1);return t},KPF.utils.arraySum=function(e){return e.reduce(function(e,i){return e+i},0)});var CCV,proto;proto=PIXI.Point.prototype,proto.scale=function(e){this.x*=e,this.y*=e},proto.floor=function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},proto.ceil=function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y)},proto.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y)},proto.minus=function(e){this.x-=e.x,this.y-=e.y},proto.plus=function(e){this.x+=e.x,this.y+=e.y},proto.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},proto.to=function(e){e.x=this.x,e.y=this.y},proto.toString=function(){return"[PIXI.Point] x: "+this.x.toFixed(1)+", y: "+this.y.toFixed(1)},proto=PIXI.Rectangle.prototype,proto.scale=function(e,i){void 0==i&&(i=e),this.x*=e,this.y*=e,this.width*=i,this.height*=i},CCV||(CCV={}),CCV.utils||(CCV.utils={},CCV.utils.drawDebugRect=function(e,i,t,s,n,o){isNaN(n)&&(n=1),isNaN(s)&&(s=1),void 0==o&&(o=!1),o&&e.beginFill(t,n),e.lineStyle(s,t,o?1:n),e.drawRect(i.x,i.y,i.width,i.height),e.moveTo(i.x,i.y),e.lineTo(i.x+i.width,i.y+i.height),e.moveTo(i.x+i.width,i.y),e.lineTo(i.x,i.y+i.height),o&&e.endFill()},CCV.utils.drawDebugPoint=function(e,i,t,s){isNaN(s)&&(s=1),e.lineStyle(s,t,1),e.drawCircle(i.x,i.y,10),e.moveTo(i.x,i.y),e.lineTo(i.x+20,i.y),e.moveTo(i.x,i.y),e.lineTo(i.x,i.y+20)}),CCV.global||(CCV.global={RED:16727593,BLUE:11391722,HEADER_HEIGHT:0,FOOTER_HEIGHT:0,SYS_FORCE_CANVAS:!1,SYS_USE_SHARED_TICKER:!0,SYS_FPS:8,SYS_ALLOW_LARGE:!1,DEBUG_LANDSCAPE_GFX:!1,DEBUG_SCENE_GFX:!1,DEBUG_SCROLL_GFX:!1,DEBUG_SCENE_MARGINS:!1,DEBUG_SWIPE:!1,AUDIO_FOLDER:"ccv/audio/",AUDIO_GLOBAL_VOLUME:.3,AUDIO_DELTA_VOLUME_COEF:.6,AUDIO_DELTA_PAN_COEF:.6,SCENE_START_INDEX:11,SCENE_START_RAND:!1,SCENE_ACTIVATION_DELAY:2e3,SCENE_DEACTIVATION_DELAY:1400,SCENE_REPEAT_DELAY:4e3,SCENE_RESTART_DELAY:2e3,SCENE_SLIDE_DURATION:1.6,SCENE_MAX_HEIGHT:650,SCENE_EXTRAVIEW_COEF:.25,SCENE_GROUND_HEIGHT:100,SCENE_ACTIVATE_BORDING_SCENES:!0,SCENE_ITEM_BEFORE:10,MEDIA_FOLDER:"ccv/",MAGNIFIER_RED:16717077,MAGNIFIER_PINCH_AMP:200,MAGNIFIER_PINCH_INCREMENT:.5,MAGNIFIER_APPEAR_TIME:.7,MAGNIFIER_VANISH_TIME:.5,MAGNIFIER_RADIUS:150,MAGNIFIER_DRAG_IDLE_TEMPO:-1,SCROLL_ELASTICITY:.08,SCROLL_SWIPE_ELASTICITY:.15,SCROLL_PREVIEW_OFFSET:120,SCROLL_MIN_OFFSET:250,SWIPE_ENABLED:!1,SWIPE_THRESHOLD:250,SWIPE_VIVACITY:400,SWIPE_VELOCITY:300}),CCV.app||(CCV.app={}),CCV.app.Player||(CCV.app.Player=function(e,i){this.target=e,this.options=Object.assign({magnifierDisplayStatus:!0,scenesShowFillStatus:!0,configurationFile:"json/config.json"},i),CCV.player=this,this.mediaFolder="",this.application=new PIXI.Application(800,600,{backgroundColor:16777215,view:this.target,transparent:!1,antialias:!0,preserveDrawingBuffer:!1,resolution:1,legacy:!1},CCV.global.SYS_FORCE_CANVAS,CCV.global.SYS_USE_SHARED_TICKER),this.application.stop(),this.animTicker=new CCV.app.AnimationsTicker,this.cbks={},this.cbks.windowFocus=this.windowFocus.bind(this),this.cbks.windowBlur=this.windowBlur.bind(this),this.cbks.resize=this.resize.bind(this),this.cbks.swCtx={name:"swCtx",active:!1,startTime:Number.NaN,startX:Number.NaN,startScrollPanelX:Number.NaN,elasticity:Number.NaN,scrollTarget:Number.NaN,scrollMin:Number.NaN,scrollMax:Number.NaN,swipeLockMin:Number.NaN,swipeLockMax:Number.NaN},Object.seal(this.cbks.swCtx),this.cbks.swipeStart=this._swipeStart.bind(this),this.cbks.swipeEnd=this._swipeEnd.bind(this),this.cbks.swipeMove=this._swipeMove.bind(this),this.cbks.scrollApply=this._scrollApply.bind(this),this.cbks.mgCtx={name:"mgCtx",dragTouch:null,pinchTouch:null,pinchStartScale:Number.NaN,pinchStartDelta:Number.NaN,idleTimeoutId:null},Object.seal(this.cbks.mgCtx),this.cbks.magnifierDragStart=this._mgDragStart.bind(this),this.cbks.magnifierDragMove=this._mgDragMove.bind(this),this.cbks.magnifierDragEnd=this._mgDragEnd.bind(this),window.onfocus=this.cbks.windowFocus,window.onblur=this.cbks.windowBlur,window.onresize=this.cbks.resize,this.landscapeHeight=CCV.global.SCENE_MAX_HEIGHT,this.groundHeight=CCV.global.SCENE_GROUND_HEIGHT,this.resizeInit(),this.configurationLoad()},proto=CCV.app.Player.prototype,proto.getMode=function(){return this.application.renderer instanceof PIXI.WebGLRenderer?"WebGL":"canvas"},proto.configurationLoad=function(){var e=this;$.ajax({url:this.options.configurationFile,dataType:"json",method:"GET",data:{context:KPF.global.PRODUCTION},error:function(i,t){KPF.utils.error('Unable to load configuration, url: "'+e.options.configurationFile+'", textStatus: "'+t+'"',"Application.loadConfiguration")},success:function(i,t){KPF.utils.log('Configuration loaded, textStatus: "'+t+'"',"Application.loadConfiguration"),e.configurationParse(i)}})},proto.configurationParse=function(e){this.landscape=new CCV.app.Landscape(e.landscape),this.application.stage.addChild(this.landscape.view),this.background=new PIXI.Graphics,this.background.beginFill(65280,0),this.background.drawRect(0,0,100,100),this.application.stage.addChild(this.background),this.magnifier=new CCV.app.Magnifier(CCV.global.MAGNIFIER_RADIUS),this.application.stage.addChild(this.magnifier.view),this.resize(),CCV.global.SCENE_START_RAND&&this.landscape.pickRandomScene(!1),this.initInteractions(),this.magnifierDisplayToggle(this.options.magnifierDisplayStatus),this.scenesShowFillToggle(this.options.scenesShowFillStatus!==!1),this.windowFocus(),this.landscape.audio.play(),$(this.target).trigger("ready",[this.landscape.scenes,this.landscape.scenesIndexed])},proto.initInteractions=function(){this.background.interactive=!0,this.background.on("pointerdown",this.cbks.swipeStart).on("pointerupoutside",this.cbks.swipeEnd).on("pointerup",this.cbks.swipeEnd),this.magnifier.view.interactive=!0,this.magnifier.view.on("pointerdown",this.cbks.magnifierDragStart)},proto._mgDragInteractionsReset=function(){this.magnifier.view.off("pointerup",this.cbks.magnifierDragEnd).off("pointerupoutside",this.cbks.magnifierDragEnd).off("pointermove",this.cbks.magnifierDragMove)},proto._mgDragStart=function(e){var i=this.cbks.mgCtx;i.idleTimeoutId&&window.clearTimeout(i.idleTimeoutId),i.dragTouch?i.pinchTouch||(i.pinchTouch=this._createTouch(e),i.pinchStartScale=this.magnifier.pinchScale,i.pinchStartDelta=this._mgPinchComputeDelta(i)):(i.dragTouch=this._createTouch(e),this.magnifier.view.on("pointerup",this.cbks.magnifierDragEnd).on("pointerupoutside",this.cbks.magnifierDragEnd).on("pointermove",this.cbks.magnifierDragMove))},proto._mgDragMove=function(e){var i,t,s=this.cbks.mgCtx;if(t=e.data.getLocalPosition(this.application.stage),s.pinchTouch){switch(e.data.identifier){case s.dragTouch.id:s.dragTouch.copy(t);break;case s.pinchTouch.id:s.pinchTouch.copy(t);break;default:return}i=this._mgPinchComputeDelta(s)-s.pinchStartDelta,i=KPF.utils.clamp(i,-CCV.global.MAGNIFIER_PINCH_AMP,CCV.global.MAGNIFIER_PINCH_AMP),this.magnifier.pinchScale=s.pinchStartScale+i/CCV.global.MAGNIFIER_PINCH_AMP*CCV.global.MAGNIFIER_PINCH_INCREMENT}else s.dragTouch&&e.data.identifier==s.dragTouch.id&&(this.magnifier.pos=t)},proto._mgDragEnd=function(e){var i=this.cbks.mgCtx;i.dragTouch=null,i.pinchTouch=null,i.pinchStartScale=Number.NaN,i.pinchStartDelta=Number.NaN,CCV.global.MAGNIFIER_DRAG_IDLE_TEMPO>0&&(i.idleTimeoutId=window.setTimeout(this._mgTidy,CCV.global.MAGNIFIER_DRAG_IDLE_TEMPO)),this._mgDragInteractionsReset()},proto._mgTidy=function(e){var i=CCV.player,t={x:.5*i.size.x,y:.9*i.size.y};e===!1?i.magnifier.pos=t:TweenMax.to(i.magnifier,.4,{ease:Circ.easeInOut,pinchScale:1,x:t.x,y:t.y})},proto._mgPinchComputeDelta=function(e){var i=new PIXI.Point;return i.copy(e.pinchTouch),i.minus(e.dragTouch),i.getLength()},proto._createTouch=function(e){return Object.assign(e.data.getLocalPosition(CCV.player.application.stage),{id:e.data.identifier})},proto._swipeStart=function(e){var i=this.cbks.swCtx;i.active||(i.active=!0,i.startTime=(new Date).getTime(),i.startX=e.data.getLocalPosition(this.application.stage).x,i.scrollMin=Math.floor(this.landscape.xTarget-this.landscape.scrollMin),i.swipeLockMin=Math.floor(i.scrollMin-this.landscape.scrollPreview),i.scrollMax=Math.ceil(this.landscape.xTarget+this.landscape.scrollMin),i.swipeLockMax=Math.ceil(i.scrollMax+this.landscape.scrollPreview),i.elasticity=CCV.global.SCROLL_ELASTICITY,i.startScrollPanelX=this.landscape.scenesScroll.x,this.background.on("pointermove",this.cbks.swipeMove),this._swipeMove(e),PIXI.ticker.shared.add(this.cbks.scrollApply))},proto._swipeMove=function(e){var i,t;i=this.cbks.swCtx,t=e.data.getLocalPosition(this.application.stage).x-i.startX,t<=-this.landscape.scrollMin?(i.scrollTarget=i.swipeLockMin,i.elasticity=CCV.global.SCROLL_SWIPE_ELASTICITY):t>=this.landscape.scrollMin?(i.scrollTarget=i.swipeLockMax,i.elasticity=CCV.global.SCROLL_SWIPE_ELASTICITY):(i.scrollTarget=i.startScrollPanelX+t,i.elasticity=CCV.global.SCROLL_ELASTICITY)},proto._scrollApply=function(e){var i=this.cbks.swCtx;isNaN(i.scrollTarget)||(this.landscape.scenesScroll.x-=(this.landscape.scenesScroll.x-i.scrollTarget)*i.elasticity)},proto._swipeEnd=function(e){var i=this.cbks.swCtx;if(i.scrollTarget==i.swipeLockMin)return this.landscape.move(1),void this._swipeReset();if(i.scrollTarget==i.swipeLockMax)return this.landscape.move(-1),void this._swipeReset();if(!CCV.global.SWIPE_ENABLED)return void this._swipeReset();var t,s,n,o,a,r,l,h=[];if(t=e.data.getLocalPosition(this.application.stage).x-i.startX,Math.abs(t)<10)return void this._swipeReset();s=Math.abs(t)>CCV.global.SWIPE_THRESHOLD,h.push("threshold: "+t.toFixed(0)+" ("+s+")"),n=(new Date).getTime()-i.startTime,o=n<CCV.global.SWIPE_VIVACITY,h.push("vicacity: "+n.toFixed(0)+" ("+o+")"),a=Math.abs(t)/n*1e3,r=a>=CCV.global.SWIPE_VELOCITY,h.push("velocity: "+a.toFixed(0)+" ("+r+")"),this._swipeReset(),l=s&&o&&r,CCV.global.DEBUG_SWIPE&&KPF.utils.log((l?"Apply":"Cancel")+" swipe gesture","Player._swipeEnd"," // "+h.join(", ")),l&&this.landscape.move(-t)},proto._swipeReset=function(){var e=this.cbks.swCtx;this.background.off("pointermove",this.cbks.swipeMove),PIXI.ticker.shared.remove(this.cbks.scrollApply),e.active=!1,e.startTime=Number.NaN,e.startX=Number.NaN,e.scrollTarget=Number.NaN,e.scrollMin=Number.NaN,e.scrollMax=Number.NaN,e.swipeLockMin=Number.NaN,e.swipeLockMax=Number.NaN,e.startScrollPanelX=Number.NaN},proto.magnifierDisplayToggle=function(e){this.magnifierDisplayStatus=KPF.utils.isbool(e)?e:!this.magnifierDisplayStatus,KPF.utils.log("magnifierDisplayStatus: "+this.magnifierDisplayStatus,"CCV.app.Player"),this.magnifierDisplayStatus?(this._mgTidy(!1),TweenMax.to(this.magnifier,CCV.global.MAGNIFIER_APPEAR_TIME,{scale:1,ease:Expo.easeIn,overwrite:"all"})):TweenMax.to(this.magnifier,CCV.global.MAGNIFIER_VANISH_TIME,{scale:0,ease:CustomEase.create("custom","M0,0,C0.646,-0.888,0.536,0.894,1,1"),overwrite:"all"}),$(this.target).trigger("magnifierDisplayChange",[this.magnifierDisplayStatus])},proto.scenesShowFillToggle=function(e){e=KPF.utils.isbool(e)?e:!this.scenesShowFillStatus,this.scenesShowFillStatus=e,KPF.utils.log("scenesShowFillStatus: "+this.scenesShowFillStatus,"Player.scenesShowFillToggle"),this.landscape.scenes.forEach(function(i){i.showFill(e)}),$(this.target).trigger("scenesShowFillChange",[this.scenesShowFillStatus])},proto.activate=function(e){e?(KPF.utils.log("Start application rendering","Player.windowFocus"),PIXI.ticker.shared.start(),this.animTicker.start()):(this.landscape.audio.stop(),KPF.utils.log("Stop application rendering","Player.activate"),this.animTicker.stop(),this.application.stop(),PIXI.ticker.shared.stop())},proto.windowBlur=function(){this.activate(!1)},proto.windowFocus=function(){this.activate(!0)},proto.resizeInit=function(){var e=screen.height-CCV.global.FOOTER_HEIGHT-CCV.global.HEADER_HEIGHT;CCV.global.SYS_ALLOW_LARGE&&e>.5*(CCV.global.SCENE_MAX_HEIGHT+CCV.global.SCENE_GROUND_HEIGHT)?(this.scaleFolder="x2",this.scaleSourceCoef=2):(this.scaleFolder="x1",this.scaleSourceCoef=1),CCV.global.SCENE_MAX_HEIGHT*=this.scaleSourceCoef,this.landscapeHeight*=this.scaleSourceCoef,this.groundHeight*=this.scaleSourceCoef,this.mediaFolder=CCV.global.MEDIA_FOLDER+this.scaleFolder+"/",KPF.utils.log("scale folder: "+this.scaleFolder+", scaleSourceCoef: "+this.scaleSourceCoef.toFixed(1),"Player.resizeInit")},proto.resize=function(){var e=!1;this.size=new PIXI.Point(window.innerWidth,window.innerHeight),this.size.y-=CCV.global.HEADER_HEIGHT,this.size.y-=CCV.global.FOOTER_HEIGHT,this.background.width=this.size.x,this.background.height=this.size.y,this.application.renderer.resize(this.size.x,this.size.y),this.scale=this.size.y/(this.landscapeHeight+this.groundHeight),this.scale>1&&(e=!0,this.scale=1),KPF.utils.log("- application size: "+this.size.toString()+"\n - application scale: "+this.scale.toFixed(2)+"\n - scaleOverflow: "+e,"Player.resize"),this.magnifier.redraw(this.scale),this._mgTidy(!1),this.landscape.resize(this.size,this.scale)},proto.triggerIndex=function(e,i,t){$(this.target).trigger("sceneIndexChange",[e,i,t])}),CCV.app.Landscape||(CCV.app.Landscape=function(e){this.view=void 0,this.ground=void 0,this.scenesScroll=void 0,this.scenesCtn=void 0,this.debugGfx=void 0,this.scenes=[],this.index=CCV.global.SCENE_START_INDEX,this.size=new PIXI.Point,this.xCenter=0,this.parse(e)},proto=CCV.app.Landscape.prototype,proto.resize=function(e,i){var t,s;this.scenesCtn.scale=new PIXI.Point(i,i),this.size=e.clone(),this.size.scale(1/i),this.size.round(),s=CCV.player.landscapeHeight+CCV.player.groundHeight,this.size.y>s?(this.size.y=s,this.view.y=Math.round(.66*(e.y-this.size.y))):this.view.y=0,this.xCenter=Math.round(.5*this.size.x),this.debugGfx.clear(),CCV.global.DEBUG_LANDSCAPE_GFX&&(t=.5*this.size.y,this.debugGfx.lineStyle(4,26163,1),this.debugGfx.moveTo(this.xCenter-20,t),this.debugGfx.lineTo(this.xCenter+20,t),this.debugGfx.moveTo(this.xCenter,t-20),this.debugGfx.lineTo(this.xCenter,t+20),this.debugGfx.lineStyle(),this.debugGfx.beginFill(16711680,.2),this.debugGfx.drawRect(0,0,this.size.x,CCV.player.landscapeHeight),this.debugGfx.endFill(),this.debugGfx.lineStyle(),this.debugGfx.beginFill(0,.2),this.debugGfx.drawRect(0,CCV.player.landscapeHeight,this.size.x,CCV.player.groundHeight),this.debugGfx.endFill()),this.setIndex(this.index,!1)},proto.toString=function(){this.info(0)},proto.info=function(e,i){var t,s="",n=this.scenes.length,o=KPF.global.FORMAT_INDENT;isNaN(e)&&(e=0),t=KPF.utils.repeat(e,o),i===!0&&(s=t),s+="[Landscape] ("+n+" scenes)";for(var a=0;a<n;++a)s+="\n"+t+o+this.scenes[a].info(e+1,!1);return s},proto.parse=function(e){var i,t,s,n,o,a,r;for(e.audio&&(this.audio=new CCV.app.AudioChannel(e.audio,!0)),this.scenes=[],this.scenesIndexed=[],i=0,t=e.scenes?e.scenes.length:0;i<t;++i)s=new CCV.app.Scene(e.scenes[i]),("_debug"!=s.id||CCV.global.DEBUG_LANDSCAPE_GFX)&&(s.indexable&&this.scenesIndexed.push({index:this.scenes.length,scene:s}),this.scenes.push(s));for(this.view=new PIXI.Container,this.scenesCtn=new PIXI.Container,this.view.addChild(this.scenesCtn),this.scenesScroll=new PIXI.Container,this.scenesCtn.addChild(this.scenesScroll),r=CCV.player.landscapeHeight,a=[],i=0,t=this.scenes.length,o=0;i<t;++i)s=this.scenes[i],o+=s.marginLeft,s.view.x=o,s.view.y=r-s.size.y,a.push(o),o+=s.size.x+s.pos.x,this.scenesScroll.addChild(s.view),s.popUnder&&n&&this.scenesScroll.swapChildren(s.view,n.view),n=s;for(this.scenesWidths=[],i=1,t=a.length;i<t;++i)this.scenesWidths.push(a[i]-a[i-1]);this.scenes.pop(),this.ground=new CCV.app.Ground(e.ground),this.ground.view.position=new PIXI.Point(0,r+this.ground.pos.y),this.scenesScroll.addChild(this.ground.view),this.debugGfx=new PIXI.Graphics,this.scenesCtn.addChild(this.debugGfx),this.scrollDebugGfx=new PIXI.Graphics,this.scenesScroll.addChild(this.scrollDebugGfx),this.scenes[0].view.x=this.scenes[0].marginLeft,this._reArrangeScenesFrom(0)},proto.pickRandomScene=function(e){var i,t;for(t=this.index;!KPF.utils.isan(i)||t==i;)i=KPF.utils.randomInt(0,this.scenes.length-1),this.scenes[i].indexable||(i=Number.NaN);e=e!==!1,KPF.utils.log("index: "+i+", doTransition: "+e,"CCV.app.Landscape.pickRandomScene"),this.setIndex(i,e)},proto.move=function(e,i){var t;if(i=i!==!1){for(var s,n,o,a=0,r=this.scenesIndexed.length;a<=r;++a)if(a==r||this.scenesIndexed[a].index>this.index){n=this.scenesIndexed[a%r],s=this.scenesIndexed[(a-1+r)%r],s.index==this.index&&(o=s,s=this.scenesIndexed[(a-2+r)%r]);break}if(0==e){if(o)return;t=Math.abs(s.index-this.index)<Math.abs(n.index-this.index)?s.index:n.index}else e<0?t=s.index:e>0&&(t=n.index)}else{if(0==e)return;t=this.index+(e>0?1:-1)}this.setIndex(t,!0)},proto.setIndex=function(e,i){var t,s,n,o,a,r,l,h,c,d,p;if(i=i!==!1,0==(s=this.scenes.length))return void KPF.log("[CCV.app.Landscape.setSceneIndex] Illegal call; scenes is empty");for(e<0?e=s-1:e>s-1&&(e=0),this.index=parseInt(e),KPF.utils.log("index: "+e,"Landscape.setIndex"),scene=this.scenes[this.index],t=0,s=this.scenesIndexed.length;t<=s;++t)if(t==s||this.scenesIndexed[t].index>this.index){p=this.scenesIndexed[t%s],d=this.scenesIndexed[(t-1+s)%s],d.index==this.index&&(d,d=this.scenesIndexed[(t-2+s)%s]);break}for(KPF.utils.log("activate sequences between ]#"+d.scene.id+", index:"+d.index+"; #"+p.scene.id+", index:"+p.index+"[","Landscape.setIndex"),s=this.scenes.length,a=Math.floor(s/2),o=-a,t=0;t<s;++t)n=t-this.index,n<o?n+=s:n>a&&(n-=s),r=CCV.global.SCENE_ACTIVATE_BORDING_SCENES?d.index>p.index?t>=d.index||t<=p.index:t>=d.index&&t<=p.index:d.index>p.index?t>d.index||t<p.index:t>d.index&&t<p.index,r&&KPF.utils.log("\t - activate index: "+t+" ("+this.scenes[t].id+")"),this.scenes[t].activateDisplay(r,n);for(this._reArrangeScenesFrom(this.index),scene=this.scenes[this.index],t=0,s=this.scenesIndexed.length;t<=s;++t)if(t==s||this.scenesIndexed[t].index>this.index){p=this.scenesIndexed[t%s],d=this.scenesIndexed[(t-1+s)%s],d.index==this.index&&(d,d=this.scenesIndexed[(t-2+s)%s]);break}l=d.scene.view.x+d.scene.pos.x+d.scene.size.x,h=p.scene.view.x+p.scene.pos.x,c=h-l,this.xTarget=this.xCenter-l-.5*c,this.scrollMin=Math.max(CCV.global.SCROLL_MIN_OFFSET,.5*(c-this.size.x)),this.scrollPreview=CCV.global.SCROLL_PREVIEW_OFFSET,KPF.utils.log("scrollMin: "+this.scrollMin+",  scrollPreview: "+this.scrollPreview,"Landscape.setIndex"),CCV.global.DEBUG_SCROLL_GFX&&(this.scrollDebugGfx.clear(),CCV.utils.drawDebugRect(this.scrollDebugGfx,new PIXI.Rectangle(l,0,h-l,CCV.global.SCENE_MAX_HEIGHT),65535,2,.5,!0)),i?TweenMax.to(this.scenesScroll,CCV.global.SCENE_SLIDE_DURATION,{x:this.xTarget,ease:Expo.easeInOut}):this.scenesScroll.x=this.xTarget,CCV.player.triggerIndex(this.index,this.scenes[this.index],this.scenes.length)},proto._reArrangeScenesFrom=function(e){var i,t,s,n;for(console.log("_reArrangeScenesFrom: "+e+", #"+this.scenes[e].id+" at: "+this.scenes[e].view.x),s=this.scenes[e].view.x,this.ground.view.x=KPF.utils.floorTo(s,this.ground.size.x)-this.ground.size.x,s=this.scenes[e].view.x,i=1,t=this.scenes.length;i<CCV.global.SCENE_ITEM_BEFORE;++i){for(n=e-i;n<0;)n+=t;n%=t,s-=this.scenesWidths[n],this.scenes[n].view.x=s}for(s=this.scenes[e].view.x+this.scenesWidths[e],i=1,t=this.scenes.length;i<t-CCV.global.SCENE_ITEM_BEFORE;++i){for(n=e+i;n<0;)n+=t;n%=t,this.scenes[n].view.x=s,s+=this.scenesWidths[n]}}),CCV.app.Scene||(CCV.app.Scene=function(e){var i=CCV.player.scaleSourceCoef;this.id=e.id,this.folder=CCV.player.mediaFolder,0!=this.id.indexOf("_")&&(this.folder+=this.id+"/"),this.indexable=e.indexable!==!1,this.disposable=e.disposable!==!1,this.popUnder=e.popUnder===!0,this.pos=new PIXI.Point,e.pos&&this.pos.copy(e.pos),this.pos.scale(i),this.marginLeft=e.marginLeft*i,this.size=new PIXI.Point(e.size.x,e.size.y),this.size.scale(i),this.xCenter=Math.round(.5*this.size.x),this.activationTimeoutId=null,e.hasOwnProperty("audio")&&(this.audio=new CCV.app.AudioChannel(e.audio)),this.viewBuild(e)},proto=CCV.app.Scene.prototype,proto.toString=function(){return this.info(0)},proto.info=function(e,i){var t,s="",n=KPF.global.FORMAT_INDENT;return isNaN(e)&&(e=0),t=KPF.utils.repeat(e,n),i===!0&&(s=t),s+="[Scene] #"+this.id,this.redFill&&(s+="\n"+t+n+"redFill: "+this.redFill.info(e+1,!1)),this.redOutline&&(s+="\n"+t+n+"redOutline: "+this.redOutline.info(e+1,!1)),this.blue&&(s+="\n"+t+n+"blue: "+this.blue.info(e+1,!1)),s},proto.factoryModel=function(e){return e?KPF.utils.isarray(e)?new CCV.app.CompoLayer(e,this):e.hasOwnProperty("video")?new CCV.app.VideoLayer(e,this):e.hasOwnProperty("seqEnd")?new CCV.app.Sequence(e,this):new CCV.app.Layer(e,this):null},proto.showFill=function(e){this.redFill&&TweenMax.to(this.redFill.view,.3,{ease:Expo.easeOut,alpha:e?1:0})},proto.viewBuild=function(e){if(this.view=new PIXI.Container,this.blue=this.factoryModel(e.blue),this.blue&&this.blue.view&&(this.blue.view.position.copy(this.pos),this.view.addChild(this.blue.view)),this.red=new CCV.app.CompoLayer(e.red),e.red&&(this.redOutline=this.red.addLayer(e.red.outline,this),this.redFill=this.red.addLayer(e.red.fill,this)),this.redFill&&this.redFill.view&&(this.redFill.view.position.copy(this.pos),this.redFill.view.blendMode=PIXI.BLEND_MODES.MULTIPLY,this.view.addChild(this.redFill.view)),this.redOutline&&this.redOutline.view&&(this.redOutline.view.position.copy(this.pos),this.redOutline.view.blendMode=PIXI.BLEND_MODES.MULTIPLY,this.view.addChild(this.redOutline.view)),CCV.global.DEBUG_SCENE_GFX){var i,t,s={fontFamily:"Verdana",fontSize:12,fill:0};this.debugGfx=new PIXI.Container,this.view.addChild(this.debugGfx),i=new PIXI.Graphics,CCV.utils.drawDebugPoint(i,this.pos,16711680,2),CCV.utils.drawDebugRect(i,new PIXI.Rectangle(this.pos.x,this.pos.y,this.size.x,this.size.y),255,1,1,!1),this.debugGfx.addChild(i),CCV.global.DEBUG_SCENE_MARGINS&&0!=this.marginLeft&&(i.lineStyle(1,255,1),i.drawRect(this.pos.x-this.marginLeft,this.pos.y,this.marginLeft,this.size.y),i.moveTo(this.pos.x,this.pos.y),i.lineTo(this.pos.x-this.marginLeft,this.pos.y+.5*this.size.y),i.lineTo(this.pos.x,this.pos.y+this.size.y),this.debugGfx.addChild(i)),t=new PIXI.Text("#"+this.id,s),t.position=new PIXI.Point(10,10),this.debugGfx.addChild(t),CCV.utils.drawDebugPoint(i,new PIXI.Point(0,0),16711680,2),CCV.utils.drawDebugRect(i,new PIXI.Rectangle(0,0,Math.abs(this.size.x+this.pos.x),this.size.y+this.pos.y),16711680,1,.2,!1)}},proto.activateDisplay=function(e,i){var t=this;this.volumeTarget=e?1:Math.max(0,1-CCV.global.AUDIO_DELTA_VOLUME_COEF*Math.abs(i)),this.panTarget=KPF.utils.clamp(i*CCV.global.AUDIO_DELTA_PAN_COEF,-1,1),this.audio&&this._launchAudio(this.audio),this.activationTimeoutId&&window.clearTimeout(this.activationTimeoutId),this.activationTimeoutId=window.setTimeout(function(){$(t).trigger("displayStateChange",[e])},e?CCV.global.SCENE_ACTIVATION_DELAY:CCV.global.SCENE_DEACTIVATION_DELAY)},proto.launchAudio=function(e,i){i=i!==!1,i?(e.isPlaying()||(startAtValues={volume:0}),TweenMax.to(e,CCV.global.SCENE_SLIDE_DURATION,{volume:this.volumeTarget,pan:this.panTarget,delay:.3,startAt:startAtValues,onUpdate:e.render.bind(e)}),this.volumeTarget>0&&!e.isPlaying()&&(e.play(),e.render())):(e.stop(),e.volume=this.volumeTarget,e.pan=this.panTarget,e.play(),e.render(),console.log("-----------------------------> audio"))}),CCV.app.CompoLayer||(CCV.app.CompoLayer=function(e,i){if(this.layers=[],e)for(var t=0,s=e.length;t<s;++t)this.addLayer(e[t],i)},proto=CCV.app.CompoLayer.prototype,proto.addLayer=function(e,i){var t=i.factoryModel(e);return this.layers.push(t),t},proto.toString=function(){return this.info(0)},proto.info=function(e,i){var t,s,n=KPF.global.FORMAT_INDENT,o=this.layers.length;isNaN(e)&&(e=0),s=KPF.utils.repeat(e,n),t=i===!0?s:"",t+="[CompoLayer] "+o+" layers";for(var a=0;a<o;++a)t+="\n"+this.layers[a].info(e+1,!0);return t}),CCV.app.Layer||(CCV.app.Layer=function(e,i){this.file=i.folder+e.file,this.view=PIXI.Sprite.fromImage(this.file)},proto=CCV.app.Layer.prototype,proto.toString=function(){return this.info(0)},proto.info=function(e,i){var t,s=KPF.global.FORMAT_INDENT;return t=i===!0?KPF.utils.repeat(e||0,s):"",t+='[Layer] file: "'+this.file+'"'}),CCV.app.Sequence||(CCV.app.Sequence=function(e,i){this.scene=i,this.parse(e),this.view=new PIXI.Container,e.hasOwnProperty("preview")&&(this.preview=new PIXI.Sprite(new PIXI.Texture.fromImage(this.scene.folder+e.preview)),this.view.addChild(this.preview)),CCV.global.DEBUG_SCENE_GFX&&(this.text=new PIXI.Text("",{fontFamily:"Verdana",fontSize:15,fill:0}),this.text.position=new PIXI.Point(20,-20),this.view.addChild(this.text)),this.active=void 0,$(this.scene).on("displayStateChange",this.activateDisplay.bind(this)),this.activateDisplay(null,!1)},proto=CCV.app.Sequence.prototype,proto.parse=function(e){this.seqNumLength=e.hasOwnProperty("seqNumLength")?e.seqNumLength:-1,this.seqStart=e.hasOwnProperty("seqStart")?e.seqStart:1,this.seqEnd=e.hasOwnProperty("seqEnd")?e.seqEnd:1,this.seqRepeatDelay=e.hasOwnProperty("seqRepeatDelay")&&e.seqRepeatDelay>=0?e.seqRepeatDelay:CCV.global.SCENE_REPEAT_DELAY,this.seqRepeatFrames=parseInt(this.seqRepeatDelay/1e3*CCV.global.SYS_FPS),this.seqRepeatSuspensionFrames=-1,this.seqRestartDelay=e.hasOwnProperty("seqRestartDelay")&&e.seqRestartDelay>=0?e.seqRestartDelay:CCV.global.SCENE_RESTART_DELAY,this.seqRestartFrames=parseInt(this.seqRestartDelay/1e3*CCV.global.SYS_FPS),this.seqRestartSuspensionFrames=-1,e.hasOwnProperty("audio")&&(this.audio=new CCV.app.AudioChannel(e.audio,!0)),this.file=e.file,this.loop=e.loop!==!1},proto.nextFrame=function(){var e=this.animation;if(e){var i=e.currentFrame+1,t=e.totalFrames;if(this.seqRepeatSuspensionFrames>0?this.seqRepeatSuspensionFrames--:0==this.seqRepeatSuspensionFrames?(this.seqRepeatSuspensionFrames=-1,this.seqRestartFrames>0?this.seqRestartSuspensionFrames=this.seqRestartFrames:this.audio&&(console.log("launch audio from repeat pause"),this.scene.launchAudio(this.audio,!1)),e.gotoAndStop(0)):this.seqRestartSuspensionFrames>0?this.seqRestartSuspensionFrames--:0==this.seqRestartSuspensionFrames?(this.seqRestartSuspensionFrames=-1,e.gotoAndStop(1),
this.audio&&(console.log("launch audio from restart pause"),this.scene.launchAudio(this.audio,!1))):i<t?e.gotoAndStop(i):(this.seqRepeatFrames>0&&(this.seqRepeatSuspensionFrames=this.seqRepeatFrames,e.gotoAndStop(t-1)),this.seqRestartFrames>0?(this.seqRestartSuspensionFrames=this.seqRestartFrames,e.gotoAndStop(0)):(e.gotoAndStop(0),this.audio&&(console.log("launch audio from loop"),this.scene.launchAudio(this.audio,!1)))),CCV.global.DEBUG_SCENE_GFX){var s=e.currentFrame+"/"+e.totalFrames;this.seqRestartFrames>0&&(s+=" [restart: "+this.seqRestartSuspensionFrames+"/"+this.seqRestartFrames+"]"),this.seqRepeatFrames>0&&(s+=" [repeat: "+this.seqRepeatSuspensionFrames+"/"+this.seqRepeatFrames+"]"),this.text.text=s}}},proto.toString=function(){return this.info(0)},proto.info=function(e,i){var t;return t=i===!0?KPF.utils.repeat(e||0,KPF.global.FORMAT_INDENT):"",t+="[Sequence] "+(this.seqEnd-this.seqStart)+" frames ["+this.seqStart+" -> "+this.seqEnd+"]"},proto.activateDisplay=function(e,i){var t,s,n;if(i=i!==!1||!this.scene.disposable,this.active!==i)if(this.active=i,this.seqRepeatSuspensionFrames=-1,!i&&this.audio&&this.audio.stop(),this.active||!this.preview){if(!this.animation){for(this.textures=[],t=this.seqStart;t<=this.seqEnd;++t)s=this.seqNumLength>0?KPF.utils.fillTo(t,this.seqNumLength,"0"):t,n=this.scene.folder+this.file.replace("[NUM]",s),this.textures.push(new PIXI.Texture.fromImage(n));this.animation=new PIXI.extras.AnimatedSprite(this.textures,!1),this.animation.textures=this.textures,this.animation.gotoAndStop(1),this.view.addChild(this.animation)}CCV.player.animTicker.addSequence(this),this.audio&&this.seqRepeatFrames+this.seqRestartFrames==0&&(console.log("launch audio from activation"),this.scene.launchAudio(this.audio,!1))}else this.animation&&(CCV.player.animTicker.removeSequence(this),this.view.removeChild(this.animation),this.animation.destroy(!0),this.animation=null)}),CCV.app.Ground||(CCV.app.Ground=function(e){this.pos=new PIXI.Point(e.pos.x,e.pos.y),this.pos.scale(CCV.player.scaleSourceCoef),this.size=new PIXI.Point(e.size.x,e.size.y),this.size.scale(CCV.player.scaleSourceCoef),this.view=new PIXI.Container;for(var i=0,t=PIXI.Texture.fromImage(CCV.player.mediaFolder+e.file);i<3;++i)gfx=PIXI.Sprite.from(t),gfx.blendMode=PIXI.BLEND_MODES.MULTIPLY,gfx.position=new PIXI.Point(i*this.size.x,0),this.view.addChild(gfx)}),CCV.app.Magnifier||(CCV.app.Magnifier=function(e){this.radius=e,this.view=new PIXI.Container,this.gfx=new PIXI.Graphics,this.gfx.blendMode=PIXI.BLEND_MODES.MULTIPLY,this.gfx.scale=new PIXI.Point(1,1),this.view.addChild(this.gfx),this._scale=0,this._x=0,this._y=0,Object.defineProperty(this,"pinchScale",{get:function(){return this.gfx.scale?this.gfx.scale.x:1},set:function(e){e=KPF.utils.clamp(e,1,1+CCV.global.MAGNIFIER_PINCH_INCREMENT),this.gfx.scale=new PIXI.Point(e,e)}}),Object.defineProperty(this,"scale",{get:function(){return this.view.scale.x},set:function(e){this._scale=e,this._render()}}),Object.defineProperty(this,"x",{get:function(){return this._x},set:function(e){this._x=e,this._render()}}),Object.defineProperty(this,"y",{get:function(){return this._y},set:function(e){this._y=e,this._render()}}),Object.defineProperty(this,"pos",{get:function(){return{x:this._x,y:this._y}},set:function(e){this._x=e.x,this._y=e.y,this._render()}}),this.scale=0},proto=CCV.app.Magnifier.prototype,proto.redraw=function(e){this.gfx.clear(),this.gfx.beginFill(CCV.global.MAGNIFIER_RED),this.gfx.drawCircle(0,0,this.radius*CCV.player.scaleSourceCoef*e),this.gfx.endFill()},proto._render=function(){new PIXI.Point(this._x,this._y).to(this.view),this.view.scale.copy({x:this._scale,y:this._scale})}),CCV.app.AnimationsTicker||(CCV.app.AnimationsTicker=function(){this.askRenderCallback=this.askRender.bind(this),this.askRenderTimeoutId=null,this.scheduled=!1,this.deltaTime=Date.now(),this.time=0,this.sequences=[],this.start()},proto=CCV.app.AnimationsTicker.prototype,proto.start=function(){this.askRender()},proto.stop=function(){clearTimeout(this.askRenderTimeoutId)},proto.addSequence=function(e){this.sequences.indexOf(e)<0&&e.animation.totalFrames>1&&this.sequences.push(e)},proto.removeSequence=function(e){var i=this.sequences.indexOf(e);i>=0&&this.sequences.splice(i,1)},proto.askRender=function(){if(this.scheduled=!1,this.deltaTime=Date.now()-this.time,this.deltaTime<1e3/CCV.global.SYS_FPS)return void(this.scheduled||(this.scheduled=!0,this.askRenderTimeoutId=setTimeout(this.askRenderCallback,1e3/CCV.global.SYS_FPS-this.deltaTime)));this.time+=this.deltaTime,CCV.player.application.render();for(var e=0,i=this.sequences.length;e<i;++e)this.sequences[e].nextFrame();requestAnimationFrame(this.askRenderCallback)}),CCV.app.AudioChannel||(CCV.app.AudioChannel=function(e,i){this.file=CCV.global.AUDIO_FOLDER+e.file,this.isLoop=e.isLoop!==!1,this.isStereo=e.isStereo!==!1,this.volumeCoef=KPF.utils.isan(e.volume)?e.volume:1,this.autoRender=i===!0,this.sound=new Howl({src:this.file,volume:0}),this._volume=1,this._pan=0,Object.defineProperty(this,"pan",{get:function(){return this._pan},set:function(e){this._pan=KPF.utils.clamp(e,-1,1),this.autoRender&&this.render()}}),Object.defineProperty(this,"volume",{get:function(){return this._volume},set:function(e){this._volume=e,this.autoRender&&this.render()}})},proto=CCV.app.AudioChannel.prototype,proto.isPlaying=function(){return this.soundId&&this.sound.playing(this.soundId)},proto.play=function(){this.soundId=this.sound.play(),this.sound.loop(this.isLoop,this.soundId),this.render()},proto.stop=function(){this.soundId&&(this.sound.stop(this.soundId),this.soundId=null)},proto.render=function(){this.soundId&&(this.sound.volume(CCV.global.AUDIO_GLOBAL_VOLUME*this.volumeCoef*this._volume,this.soundId),this.sound.stereo(this._pan,this.soundId))},proto.toString=function(){return"[AudioChannel] loop:"+this.loop+", stereo: "+this.stereo+", volumeCoef: "+this.volumeCoef},proto.info=function(e,i){var t,s=KPF.global.FORMAT_INDENT,n=KPF.utils.repeat(e||0,s);return t=i===!0?n:"",t+="[AudioChannel] ",t+="\n"+n+s+'file: "'+this.file+'"',t+="\n"+n+s+"loop:"+this.loop+", stereo: "+this.stereo+", volumeCoef: "+this.volumeCoef});